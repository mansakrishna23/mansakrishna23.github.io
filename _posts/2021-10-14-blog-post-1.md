---
layout: post
title: Blog Post 1 - Conquering Databases and Interactive Visualizations ft. NOAA Climate Data Set
---

In this post I will outline how to create several interesting, interactive data graphics using the NOAA climate data set.
### Downloading the Data
As always, the first thing we have to do before constructing any sort of data visualisation is to first download and read in the data. To read in the temperature, station-metadata, and countries data, I will be used the Pandas package and running the following lines of code:

```python
import pandas as pd

temperatures = pd.read_csv(data_path+"temps.csv")
stations = pd.read_csv(data_path+"station-metadata.csv")
countries = pd.read_csv(data_path+"countries.csv")
```
As always, after reading the data into Jupyter Notebook, it is always a good practice to make sure that the data has been read in correctly by using the `.head()` function to check the first few rows of the data frame and the `.shape` function to check the shape of the data frame. 

```python
# Checking the temperatures data
temperatures.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Year</th>
      <th>VALUE1</th>
      <th>VALUE2</th>
      <th>VALUE3</th>
      <th>VALUE4</th>
      <th>VALUE5</th>
      <th>VALUE6</th>
      <th>VALUE7</th>
      <th>VALUE8</th>
      <th>VALUE9</th>
      <th>VALUE10</th>
      <th>VALUE11</th>
      <th>VALUE12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ACW00011604</td>
      <td>1961</td>
      <td>-89.0</td>
      <td>236.0</td>
      <td>472.0</td>
      <td>773.0</td>
      <td>1128.0</td>
      <td>1599.0</td>
      <td>1570.0</td>
      <td>1481.0</td>
      <td>1413.0</td>
      <td>1174.0</td>
      <td>510.0</td>
      <td>-39.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ACW00011604</td>
      <td>1962</td>
      <td>113.0</td>
      <td>85.0</td>
      <td>-154.0</td>
      <td>635.0</td>
      <td>908.0</td>
      <td>1381.0</td>
      <td>1510.0</td>
      <td>1393.0</td>
      <td>1163.0</td>
      <td>994.0</td>
      <td>323.0</td>
      <td>-126.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ACW00011604</td>
      <td>1963</td>
      <td>-713.0</td>
      <td>-553.0</td>
      <td>-99.0</td>
      <td>541.0</td>
      <td>1224.0</td>
      <td>1627.0</td>
      <td>1620.0</td>
      <td>1596.0</td>
      <td>1332.0</td>
      <td>940.0</td>
      <td>566.0</td>
      <td>-108.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ACW00011604</td>
      <td>1964</td>
      <td>62.0</td>
      <td>-85.0</td>
      <td>55.0</td>
      <td>738.0</td>
      <td>1219.0</td>
      <td>1442.0</td>
      <td>1506.0</td>
      <td>1557.0</td>
      <td>1221.0</td>
      <td>788.0</td>
      <td>546.0</td>
      <td>112.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ACW00011604</td>
      <td>1965</td>
      <td>44.0</td>
      <td>-105.0</td>
      <td>38.0</td>
      <td>590.0</td>
      <td>987.0</td>
      <td>1500.0</td>
      <td>1487.0</td>
      <td>1477.0</td>
      <td>1377.0</td>
      <td>974.0</td>
      <td>31.0</td>
      <td>-178.0</td>
    </tr>
  </tbody>
</table>
</div>

```python
# Checking the shape of the temperatures data frame
temperatures.shape
```




    (1359937, 14)

```python
# Checking the stations data
stations.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>STNELEV</th>
      <th>NAME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ACW00011604</td>
      <td>57.7667</td>
      <td>11.8667</td>
      <td>18.0</td>
      <td>SAVE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AE000041196</td>
      <td>25.3330</td>
      <td>55.5170</td>
      <td>34.0</td>
      <td>SHARJAH_INTER_AIRP</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AEM00041184</td>
      <td>25.6170</td>
      <td>55.9330</td>
      <td>31.0</td>
      <td>RAS_AL_KHAIMAH_INTE</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AEM00041194</td>
      <td>25.2550</td>
      <td>55.3640</td>
      <td>10.4</td>
      <td>DUBAI_INTL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AEM00041216</td>
      <td>24.4300</td>
      <td>54.4700</td>
      <td>3.0</td>
      <td>ABU_DHABI_BATEEN_AIR</td>
    </tr>
  </tbody>
</table>
</div>

```python
# Checking the shape of the stations data frame
stations.shape
```




    (27585, 5)

```python
# Checking the countries data
countries.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FIPS 10-4</th>
      <th>ISO 3166</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AF</td>
      <td>AF</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AX</td>
      <td>-</td>
      <td>Akrotiri</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>AL</td>
      <td>Albania</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AG</td>
      <td>DZ</td>
      <td>Algeria</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AQ</td>
      <td>AS</td>
      <td>American Samoa</td>
    </tr>
  </tbody>
</table>
</div>

```python
# Checking the shape of the countries data frame
countries.shape
```




    (279, 3)

### Creating a Database to Store the Data
Notice that the `temperatures` and `stations` data frame are rather large data sets. Generally speaking, larger data sets tend to be noticeably slow to load into memory. While these particular data sets are not too large to fit in memory, they are large enough that it takes a while to load them into pandas. 

And yet, while these data sets are large, it is rare that we would have to operate on the entire data set at once. Instead, we would instead work with parts of the data at any given time. As such it would be easier for us to create a database using Python's `sqlite3` module, which would provide us with a structured way to move subsets of data from storage into memory. 

```python
import sqlite3
# create a database in current directory called data.db
# to store temperatures, stations, and countries tables
conn = sqlite3.connect("data.db") 
```
Now, before appending our data to this database, let us first clean and manipulate it a little bit! First consider the following temperatures data frame


```python
temperatures.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Year</th>
      <th>VALUE1</th>
      <th>VALUE2</th>
      <th>VALUE3</th>
      <th>VALUE4</th>
      <th>VALUE5</th>
      <th>VALUE6</th>
      <th>VALUE7</th>
      <th>VALUE8</th>
      <th>VALUE9</th>
      <th>VALUE10</th>
      <th>VALUE11</th>
      <th>VALUE12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ACW00011604</td>
      <td>1961</td>
      <td>-89.0</td>
      <td>236.0</td>
      <td>472.0</td>
      <td>773.0</td>
      <td>1128.0</td>
      <td>1599.0</td>
      <td>1570.0</td>
      <td>1481.0</td>
      <td>1413.0</td>
      <td>1174.0</td>
      <td>510.0</td>
      <td>-39.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ACW00011604</td>
      <td>1962</td>
      <td>113.0</td>
      <td>85.0</td>
      <td>-154.0</td>
      <td>635.0</td>
      <td>908.0</td>
      <td>1381.0</td>
      <td>1510.0</td>
      <td>1393.0</td>
      <td>1163.0</td>
      <td>994.0</td>
      <td>323.0</td>
      <td>-126.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ACW00011604</td>
      <td>1963</td>
      <td>-713.0</td>
      <td>-553.0</td>
      <td>-99.0</td>
      <td>541.0</td>
      <td>1224.0</td>
      <td>1627.0</td>
      <td>1620.0</td>
      <td>1596.0</td>
      <td>1332.0</td>
      <td>940.0</td>
      <td>566.0</td>
      <td>-108.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ACW00011604</td>
      <td>1964</td>
      <td>62.0</td>
      <td>-85.0</td>
      <td>55.0</td>
      <td>738.0</td>
      <td>1219.0</td>
      <td>1442.0</td>
      <td>1506.0</td>
      <td>1557.0</td>
      <td>1221.0</td>
      <td>788.0</td>
      <td>546.0</td>
      <td>112.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ACW00011604</td>
      <td>1965</td>
      <td>44.0</td>
      <td>-105.0</td>
      <td>38.0</td>
      <td>590.0</td>
      <td>987.0</td>
      <td>1500.0</td>
      <td>1487.0</td>
      <td>1477.0</td>
      <td>1377.0</td>
      <td>974.0</td>
      <td>31.0</td>
      <td>-178.0</td>
    </tr>
  </tbody>
</table>
</div>

The first thing we want to do is explicitly extract the country code, i.e., the first two letters of each `ID` number. We can do so using the following chunk of code:

```python
temperatures['ID'] = temperatures["ID"].str[0:2]
temperatures.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Year</th>
      <th>VALUE1</th>
      <th>VALUE2</th>
      <th>VALUE3</th>
      <th>VALUE4</th>
      <th>VALUE5</th>
      <th>VALUE6</th>
      <th>VALUE7</th>
      <th>VALUE8</th>
      <th>VALUE9</th>
      <th>VALUE10</th>
      <th>VALUE11</th>
      <th>VALUE12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AC</td>
      <td>1961</td>
      <td>-89.0</td>
      <td>236.0</td>
      <td>472.0</td>
      <td>773.0</td>
      <td>1128.0</td>
      <td>1599.0</td>
      <td>1570.0</td>
      <td>1481.0</td>
      <td>1413.0</td>
      <td>1174.0</td>
      <td>510.0</td>
      <td>-39.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AC</td>
      <td>1962</td>
      <td>113.0</td>
      <td>85.0</td>
      <td>-154.0</td>
      <td>635.0</td>
      <td>908.0</td>
      <td>1381.0</td>
      <td>1510.0</td>
      <td>1393.0</td>
      <td>1163.0</td>
      <td>994.0</td>
      <td>323.0</td>
      <td>-126.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AC</td>
      <td>1963</td>
      <td>-713.0</td>
      <td>-553.0</td>
      <td>-99.0</td>
      <td>541.0</td>
      <td>1224.0</td>
      <td>1627.0</td>
      <td>1620.0</td>
      <td>1596.0</td>
      <td>1332.0</td>
      <td>940.0</td>
      <td>566.0</td>
      <td>-108.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AC</td>
      <td>1964</td>
      <td>62.0</td>
      <td>-85.0</td>
      <td>55.0</td>
      <td>738.0</td>
      <td>1219.0</td>
      <td>1442.0</td>
      <td>1506.0</td>
      <td>1557.0</td>
      <td>1221.0</td>
      <td>788.0</td>
      <td>546.0</td>
      <td>112.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AC</td>
      <td>1965</td>
      <td>44.0</td>
      <td>-105.0</td>
      <td>38.0</td>
      <td>590.0</td>
      <td>987.0</td>
      <td>1500.0</td>
      <td>1487.0</td>
      <td>1477.0</td>
      <td>1377.0</td>
      <td>974.0</td>
      <td>31.0</td>
      <td>-178.0</td>
    </tr>
  </tbody>
</table>
</div>

Now, notice that each of the `VALUE` columns in the above table correspond to the months of the year. To make this data set a little more readable, we might want to create a seperate month column and stack the temperatures accordingly. 

```python
temperatures = temperatures.set_index(keys=["ID", "Year"])
temperatures = temperatures.stack() # stacking the months and temperatures
temperatures = temperatures.reset_index()
temperatures.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Year</th>
      <th>level_2</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE1</td>
      <td>-89.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE2</td>
      <td>236.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE3</td>
      <td>472.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE4</td>
      <td>773.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE5</td>
      <td>1128.0</td>
    </tr>
  </tbody>
</table>
</div>

For the sake of readability, let us rename the `level_2` and `0` columns. 

```python
temperatures = temperatures.rename(columns = {"level_2" : "Month", 0 : "Temp"})
temperatures.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Year</th>
      <th>Month</th>
      <th>Temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE1</td>
      <td>-89.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE2</td>
      <td>236.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE3</td>
      <td>472.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE4</td>
      <td>773.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AC</td>
      <td>1961</td>
      <td>VALUE5</td>
      <td>1128.0</td>
    </tr>
  </tbody>
</table>
</div>

Notice that our month column comprises of values: `VALUE1, ..., VALUE12`. While it is understandable, it might be more interpretable if we replace each of those values with the integer value corresponding to each month (as follows). Additionally, we want to divide our temperature column by 100 to extract the appropriate temperature values. 

```python
temperatures["Month"] = temperatures["Month"].str[5:].astype(int)
temperatures["Temp"]  = temperatures["Temp"] / 100
temperatures.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Year</th>
      <th>Month</th>
      <th>Temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AC</td>
      <td>1961</td>
      <td>1</td>
      <td>-0.89</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AC</td>
      <td>1961</td>
      <td>2</td>
      <td>2.36</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AC</td>
      <td>1961</td>
      <td>3</td>
      <td>4.72</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AC</td>
      <td>1961</td>
      <td>4</td>
      <td>7.73</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AC</td>
      <td>1961</td>
      <td>5</td>
      <td>11.28</td>
    </tr>
  </tbody>
</table>
</div>

Now that we have successfully cleaned and manipulated the `temperatures` data set, we can now append it to the data base as follows:

```python
temperatures.to_sql("temperatures", conn, if_exists = "append", index=False)
```

It is good practice to check whether the data frame has been added to the database! So, let's do that:

```python
# Checking that we have a "temperatures" table within the database
cursor = conn.cursor()
cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
print(cursor.fetchall())
```

    [('temperatures',)]

Now, consider the stations-metadata data frame.

```python
stations.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>STNELEV</th>
      <th>NAME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ACW00011604</td>
      <td>57.7667</td>
      <td>11.8667</td>
      <td>18.0</td>
      <td>SAVE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AE000041196</td>
      <td>25.3330</td>
      <td>55.5170</td>
      <td>34.0</td>
      <td>SHARJAH_INTER_AIRP</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AEM00041184</td>
      <td>25.6170</td>
      <td>55.9330</td>
      <td>31.0</td>
      <td>RAS_AL_KHAIMAH_INTE</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AEM00041194</td>
      <td>25.2550</td>
      <td>55.3640</td>
      <td>10.4</td>
      <td>DUBAI_INTL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AEM00041216</td>
      <td>24.4300</td>
      <td>54.4700</td>
      <td>3.0</td>
      <td>ABU_DHABI_BATEEN_AIR</td>
    </tr>
  </tbody>
</table>
</div>

Again, the first thing we want to do is explicitly extract the country code, i.e., the first two letters of each `ID` number, which will make it easier for us to compare table values later on

```python
stations['ID'] = stations["ID"].str[0:2]
stations.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>STNELEV</th>
      <th>NAME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AC</td>
      <td>57.7667</td>
      <td>11.8667</td>
      <td>18.0</td>
      <td>SAVE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AE</td>
      <td>25.3330</td>
      <td>55.5170</td>
      <td>34.0</td>
      <td>SHARJAH_INTER_AIRP</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AE</td>
      <td>25.6170</td>
      <td>55.9330</td>
      <td>31.0</td>
      <td>RAS_AL_KHAIMAH_INTE</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AE</td>
      <td>25.2550</td>
      <td>55.3640</td>
      <td>10.4</td>
      <td>DUBAI_INTL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AE</td>
      <td>24.4300</td>
      <td>54.4700</td>
      <td>3.0</td>
      <td>ABU_DHABI_BATEEN_AIR</td>
    </tr>
  </tbody>
</table>
</div>

Now let'd go ahead and also add this data set to the database as well!

```python
stations.to_sql("stations", conn, if_exists = "replace", index=False)
```

Lastly, we will consider the countries data set. 

```python
countries.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FIPS 10-4</th>
      <th>ISO 3166</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AF</td>
      <td>AF</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AX</td>
      <td>-</td>
      <td>Akrotiri</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>AL</td>
      <td>Albania</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AG</td>
      <td>DZ</td>
      <td>Algeria</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AQ</td>
      <td>AS</td>
      <td>American Samoa</td>
    </tr>
  </tbody>
</table>
</div>

The first thing we want to do is remove the `ISO 3166` column which corresponds to the general political region. We are only interested in the `FIPS 10-4` column which corresponds to the country code and the `Name` of the country. 

```python
# dropping the ISO 3166 column
countries = countries.drop('ISO 3166', axis=1)
countries.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FIPS 10-4</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AF</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AX</td>
      <td>Akrotiri</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>Albania</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AG</td>
      <td>Algeria</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AQ</td>
      <td>American Samoa</td>
    </tr>
  </tbody>
</table>
</div>

Now, we want to rename the `FIPS 10-4` column to improve the readability.

```python
countries = countries.rename(columns = {"FIPS 10-4" : "ID", "ISO 3166" : "ISO-3166"})
countries.head()
```
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AF</td>
      <td>Afghanistan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AX</td>
      <td>Akrotiri</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>Albania</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AG</td>
      <td>Algeria</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AQ</td>
      <td>American Samoa</td>
    </tr>
  </tbody>
</table>
</div>

Now, we are ready to add our last data set to the database!

```python
countries.to_sql("countries", conn, if_exists="replace", index="False")
```

When we check our database, we should be able to see three seperate data tables: temperatures, stations, and countries. 

```python
cursor = conn.cursor()
cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
print(cursor.fetchall())
```

    [('temperatures',), ('stations',), ('countries',)]

To be safe, let us also look at the columns within each of these tables.

```python
cursor.execute("SELECT sql FROM sqlite_master WHERE type='table';")

for result in cursor.fetchall():
    print(result[0])
```

    CREATE TABLE "temperatures" (
    "ID" TEXT,
      "Year" INTEGER,
      "Month" INTEGER,
      "Temp" REAL
    )
    CREATE TABLE "stations" (
    "ID" TEXT,
      "LATITUDE" REAL,
      "LONGITUDE" REAL,
      "STNELEV" REAL,
      "NAME" TEXT
    )
    CREATE TABLE "countries" (
    "False" INTEGER,
      "ID" TEXT,
      "Name" TEXT
    )

Now that we have finished constructing and checking our database, we can close the database connection using the `.close()` function.

```python
conn.close()
```

### Writing a Query Function

Now that we have created a database, `"data.db"`, we want to write a function that will query the appropriate temperature data for us. In other words, we will write a function that returns a Pandas Dataframe of temperature readings for a specified country, within a specified date range, and in the specified month of the given years. 

As a general note, always remember to document your function appropriately so that other users find it easy to implement the function you have written!


```python
def query_climate_database(country, year_begin, year_end, month):
    """Function returns a dataframe of temperature readings for the 
    specified country, in the specific date range, in the specified month
    of the year
    
    Parameters
    ----------
    country : string
        the name of a country for which data should be returned
    year_begin : integer
        the earliest year for which data should be returned
    year_end : integer
        the latest year for which data should be returned
    month : integer
        month of the year for which data should be returned
    
    Returns
    ----------
    DataFrame 
        Pandas dataframe of temperature readings for the specified country, 
        in the specified date range, in the specified month of the year
    """
    # opening the database
    conn = sqlite3.connect("data.db")
    cmd = \
    f"""
    SELECT s.NAME, s.LATITUDE, s.LONGITUDE, c.Name AS Country, t.Year, t.Month, t.Temp
    FROM temperatures t
    LEFT JOIN countries c ON t.ID = c.ID
    LEFT JOIN stations s ON t.ID = s.ID
    WHERE t.Year>={str(year_begin)} AND t.Year<={str(year_end)} AND t.Month={str(month)} AND c.Name='{country}'
    """
    df = pd.read_sql_query(cmd, conn) # extracting the appropriate dataframe
    conn.close() # closing the database
    
    return df
```

Whenever we write a function, we always need to make sure it works properly! Let's go ahead and test the above function!


```python
# TEST CASE
country = "India"
year_begin = 1980
year_end = 2020
month = 1 # The month of January

query_climate_database(country, year_begin, year_end, month)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NAME</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>Country</th>
      <th>Year</th>
      <th>Month</th>
      <th>Temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MINICOYOBSY</td>
      <td>8.3000</td>
      <td>73.0000</td>
      <td>India</td>
      <td>1980</td>
      <td>1</td>
      <td>2.08</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MINICOY</td>
      <td>8.3000</td>
      <td>73.1500</td>
      <td>India</td>
      <td>1980</td>
      <td>1</td>
      <td>2.08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>THIRUVANANTHAPURAM</td>
      <td>8.4670</td>
      <td>76.9500</td>
      <td>India</td>
      <td>1980</td>
      <td>1</td>
      <td>2.08</td>
    </tr>
    <tr>
      <th>3</th>
      <td>THIRUVANANTHAPURAM</td>
      <td>8.4830</td>
      <td>76.9500</td>
      <td>India</td>
      <td>1980</td>
      <td>1</td>
      <td>2.08</td>
    </tr>
    <tr>
      <th>4</th>
      <td>TRIVANDRUM</td>
      <td>8.5000</td>
      <td>77.0000</td>
      <td>India</td>
      <td>1980</td>
      <td>1</td>
      <td>2.08</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>371931</th>
      <td>LUDHIANA</td>
      <td>30.9333</td>
      <td>75.8667</td>
      <td>India</td>
      <td>2020</td>
      <td>1</td>
      <td>29.35</td>
    </tr>
    <tr>
      <th>371932</th>
      <td>SHIMLA</td>
      <td>31.1000</td>
      <td>77.1670</td>
      <td>India</td>
      <td>2020</td>
      <td>1</td>
      <td>29.35</td>
    </tr>
    <tr>
      <th>371933</th>
      <td>AMRITSAR</td>
      <td>31.7100</td>
      <td>74.7970</td>
      <td>India</td>
      <td>2020</td>
      <td>1</td>
      <td>29.35</td>
    </tr>
    <tr>
      <th>371934</th>
      <td>SRINAGAR</td>
      <td>34.0830</td>
      <td>74.8330</td>
      <td>India</td>
      <td>2020</td>
      <td>1</td>
      <td>29.35</td>
    </tr>
    <tr>
      <th>371935</th>
      <td>LEH_KASHMIR</td>
      <td>34.2000</td>
      <td>77.7000</td>
      <td>India</td>
      <td>2020</td>
      <td>1</td>
      <td>29.35</td>
    </tr>
  </tbody>
</table>
<p>371936 rows × 7 columns</p>
</div>

### Writing a Geographic Scatter Function for Yearly Temperature Increases
We want to write a function that will help us address the following question: "How does the average yearly change in temperature vary within a given country?"

In other words, we would like to write a function that returns an interactive geographic scatterplot that reflects the yearly change in temperature during the specified month and time period at that station. Luckily for us, we have a very handy library, Plotly Express, to help us with our visualization. To find the average yearly change in temperature (in a given month), we might want to compute the first coefficient of a linear regression model (at a given station). To construct our linear regression model we could use the scikit-learn module!

```python
from plotly import express as px
from sklearn.linear_model import LinearRegression

# Other potentially useful libraries
import numpy as np
import seaborn as sns
from matplotlib import pyplot as plt
```

Before jumping to our main function that will plot a geographic scatterplot, we may first want to write our helper function `coef` that would help us determine the yearly average temperature change in a given month, using linear regression.


```python
def coef(data_group):
    # extracting x and y for linear regression
    x = data_group[['Year']]
    y = data_group['Temp']
    # The linear regression model
    LR = LinearRegression()
    LR.fit(x,y)
    # returning the coefficients
    return LR.coef_[0]
```


```python
def temperature_coefficient_plot(country, year_begin, year_end, month, min_obs, **kwargs):
    """Function generates an interactive geographic scatterplot,
    with a point for each station, such that the color of the point reflects 
    an estimate of the yearly change in temperature during the specified 
    month and time period at that station.
    
    Parameters
    ----------
    country : string
        the name of a country for which data should be returned
    year_begin : integer
        the earliest year for which data should be returned
    year_end : integer
        the latest year for which data should be returned
    month : integer
        month of the year for which data should be returned
    min_obs : integer
        minimum required number of years of data for any given station
    **kwargs 
        additional keyword arguments passed to px.scatter_mapbox(). 
        These can be used to control the colormap used, the mapbox style, etc.
    
    Returns
    ----------
    scatterplot
        An interactive geographic scatterplot, constructed using Plotly Express, 
        with a point for each station, such that the color of the point reflects 
        an estimate of the yearly change in temperature during the specified 
        month and time period at that station
    """
    # extracting the temperature reading data frame for the given
    # country, month, and years
    df = query_climate_database(country, year_begin, year_end, month)
    
    # extracting a list of unique station names
    station_names = df['NAME'].unique() 
    stations_to_keep = []
    
    for name in station_names: 
        temp_df = df[df['NAME'] == name]
        # checking the years of data available for
        # the specified month
        number_of_years = temp_df['Year'].nunique()
        if number_of_years >= min_obs:
            stations_to_keep.append(name)
    
    # Now that we have a list of the stations to keep
    # we create another data frame 
    df_new = pd.DataFrame()
    for station_name in stations_to_keep:
        tempdf = df[df['NAME'] == station_name]
        # concatenating the temporary data frame
        # with the new data frame
        df_new = pd.concat([df_new, tempdf])
        
    # Extracting the average temperatures per month, per year
    df_new = df_new.groupby(["NAME", "LATITUDE", "LONGITUDE", "Country", 'Year', "Month"])["Temp"].aggregate(np.mean)
    df_new = pd.DataFrame(df_new) # appending the above to a data frame
    df_new = df_new.reset_index() # and resetting the index appropriately
    
    # array of station names from the new data frame
    new_station_names = df_new['NAME'].unique()
    # Arrays to store the coefficients, latitudes, and longitudes
    coefs = np.array([])
    lats = np.array([])
    longs = np.array([])
    
    for sname in station_names:
        df_temp = df_new[df_new['NAME'] == sname]
        lats = np.append(lats, df_temp['LATITUDE'].unique()[0])
        longs = np.append(longs, df_temp['LONGITUDE'].unique()[0])
        coefs = np.append(coefs, coef(df_temp))
    
    # Creating a data frame of coefficients representing yearly temp change
    coef_df = pd.DataFrame()
    coef_df['NAME'] = station_names
    coef_df['LATITUDE'] = lats
    coef_df['LONGITUDE'] = longs
    coef_df['Estimated Yearly Increase (°C)'] = np.round(coefs, 5)
    
    # Generating the scatter plot
    fig = px.scatter_mapbox(coef_df, 
                            lat = "LATITUDE",
                            lon = "LONGITUDE", 
                            hover_name = "NAME", 
                            color = "Estimated Yearly Increase (°C)",
                            **kwargs)

    fig.update_layout(margin={"r":0,"t":0,"l":0,"b":0})
    return fig
```

As always, it is good practice to test our functions!


```python
# TEST CASE
country = "India"
year_begin = 1980
year_end = 2020
month = 1
min_obs = 10

# Implementing the function
fig = temperature_coefficient_plot(country, year_begin, year_end, month, min_obs, zoom = 3, 
                                   mapbox_style = "carto-positron")
fig.show()
```

{% include bp1-geo_scatter.html %}

### Creating Other Interesting Visualizations
Plotly Express not only helps us with interactive geographic scatterplots (depicted above), we can also plot our usual graphs (like histograms, line graphs, scatterplots, etc.) that we normally would do with matplotlib or seaborn. However, the interesting thing about Plotly is that we can take our visualizations to the next level by making them interactive! 

To illustrate this capability let us plot a regular scatter plot of temperature readings, depicting the yearly temperatures versus the month (Note that a latitude above 0°N is above the equator while a latitude below 0°N is below the equator). We first want to re-write our query function to extract only the data we need!

```python
def query_climate_database_v2(country, year_begin, year_end):
    """Function returns a dataframe of temperature readings for the 
    specified country, in the specific date range, in the specified month
    of the year
    
    Parameters
    ----------
    country : string
        the name of a country for which data should be returned
    year_begin : integer
        the earliest year for which data should be returned
    year_end : integer
        the latest year for which data should be returned
    
    Returns
    ----------
    DataFrame 
        Pandas dataframe of temperature readings for the specified country, 
        in the specified date range. 
    """
    # opening the database
    conn = sqlite3.connect("data.db")
    cmd = \
    f"""
    SELECT s.LATITUDE, s.LONGITUDE, c.Name AS Country, s.NAME, t.Year, t.Month, t.Temp
    FROM temperatures t
    LEFT JOIN countries c ON t.ID = c.ID
    LEFT JOIN stations s ON t.ID = s.ID
    WHERE t.Year>={str(year_begin)} AND t.Year<{str(year_end)} AND c.Name='{country}'
    """
    df = pd.read_sql_query(cmd, conn) # extracting the appropriate dataframe
    conn.close() # closing the database
    
    return df
```


```python
# TEST CASE: Let us pick a country that falls on the equator, like Brazil!
df2 = query_climate_database_v2("Brazil", 1990, 2020)
df2
```



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>Country</th>
      <th>NAME</th>
      <th>Year</th>
      <th>Month</th>
      <th>Temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-33.517</td>
      <td>-53.350</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>1</td>
      <td>18.78</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-32.017</td>
      <td>-52.083</td>
      <td>Brazil</td>
      <td>RIO_GRANDE</td>
      <td>1990</td>
      <td>1</td>
      <td>18.78</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-31.780</td>
      <td>-52.410</td>
      <td>Brazil</td>
      <td>PELOTAS</td>
      <td>1990</td>
      <td>1</td>
      <td>18.78</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-31.333</td>
      <td>-54.100</td>
      <td>Brazil</td>
      <td>BAGE</td>
      <td>1990</td>
      <td>1</td>
      <td>18.78</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-30.830</td>
      <td>-55.600</td>
      <td>Brazil</td>
      <td>SANTANA_DO_LIVRAMENTO</td>
      <td>1990</td>
      <td>1</td>
      <td>18.78</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>22481195</th>
      <td>0.610</td>
      <td>-69.180</td>
      <td>Brazil</td>
      <td>IAUARETE</td>
      <td>2019</td>
      <td>12</td>
      <td>31.10</td>
    </tr>
    <tr>
      <th>22481196</th>
      <td>1.833</td>
      <td>-61.133</td>
      <td>Brazil</td>
      <td>CARACARAI</td>
      <td>2019</td>
      <td>12</td>
      <td>31.10</td>
    </tr>
    <tr>
      <th>22481197</th>
      <td>2.067</td>
      <td>-50.850</td>
      <td>Brazil</td>
      <td>AMAPA</td>
      <td>2019</td>
      <td>12</td>
      <td>31.10</td>
    </tr>
    <tr>
      <th>22481198</th>
      <td>2.817</td>
      <td>-60.650</td>
      <td>Brazil</td>
      <td>BOA_VISTA</td>
      <td>2019</td>
      <td>12</td>
      <td>31.10</td>
    </tr>
    <tr>
      <th>22481199</th>
      <td>2.833</td>
      <td>-60.700</td>
      <td>Brazil</td>
      <td>BOA_VISTAAEROPORT</td>
      <td>2019</td>
      <td>12</td>
      <td>31.10</td>
    </tr>
  </tbody>
</table>
<p>22481200 rows × 7 columns</p>
</div>




```python
# Extracting the average temperatures per month, per year
df2 = df2.groupby(["LATITUDE", "LONGITUDE", "Country", "NAME", 'Year', "Month"])["Temp"].aggregate(np.mean)
df2 = pd.DataFrame(df2) # appending the above to a data frame
df2 = df2.reset_index() # and resetting the index appropriately
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>Country</th>
      <th>NAME</th>
      <th>Year</th>
      <th>Month</th>
      <th>Temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>1</td>
      <td>25.940840</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>2</td>
      <td>25.650976</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>3</td>
      <td>25.886124</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>4</td>
      <td>25.287054</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>5</td>
      <td>22.841311</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>125995</th>
      <td>2.833</td>
      <td>-60.70</td>
      <td>Brazil</td>
      <td>BOA_VISTAAEROPORT</td>
      <td>2019</td>
      <td>8</td>
      <td>23.764634</td>
    </tr>
    <tr>
      <th>125996</th>
      <td>2.833</td>
      <td>-60.70</td>
      <td>Brazil</td>
      <td>BOA_VISTAAEROPORT</td>
      <td>2019</td>
      <td>9</td>
      <td>25.871429</td>
    </tr>
    <tr>
      <th>125997</th>
      <td>2.833</td>
      <td>-60.70</td>
      <td>Brazil</td>
      <td>BOA_VISTAAEROPORT</td>
      <td>2019</td>
      <td>10</td>
      <td>26.625412</td>
    </tr>
    <tr>
      <th>125998</th>
      <td>2.833</td>
      <td>-60.70</td>
      <td>Brazil</td>
      <td>BOA_VISTAAEROPORT</td>
      <td>2019</td>
      <td>11</td>
      <td>26.701905</td>
    </tr>
    <tr>
      <th>125999</th>
      <td>2.833</td>
      <td>-60.70</td>
      <td>Brazil</td>
      <td>BOA_VISTAAEROPORT</td>
      <td>2019</td>
      <td>12</td>
      <td>26.719643</td>
    </tr>
  </tbody>
</table>
<p>126000 rows × 7 columns</p>
</div>




```python
# Add a column to determine whether the point is above or
# below the equator
latitudes = np.array(df2['LATITUDE'])

# above or below or on equator? 
equator = np.array([])

for lat in latitudes:
    if lat < 0:
        equator = np.append(equator, 'below')
    elif lat > 0: 
        equator = np.append(equator, 'above')
    else: 
        equator = np.append(equator, 'on')
        
df2['Position Relative to Equator (0°N)'] = equator
df2.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>Country</th>
      <th>NAME</th>
      <th>Year</th>
      <th>Month</th>
      <th>Temp</th>
      <th>Position Relative to Equator (0°N)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>1</td>
      <td>25.940840</td>
      <td>below</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>2</td>
      <td>25.650976</td>
      <td>below</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>3</td>
      <td>25.886124</td>
      <td>below</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>4</td>
      <td>25.287054</td>
      <td>below</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-33.517</td>
      <td>-53.35</td>
      <td>Brazil</td>
      <td>STVITORIA_DO_PALMAR</td>
      <td>1990</td>
      <td>5</td>
      <td>22.841311</td>
      <td>below</td>
    </tr>
  </tbody>
</table>
</div>



Now that we have a clean data set with all the information we need, we are ready to create our visualization using Plotly!


```python
fig = px.scatter(df2, 
                 x = "Month", 
                 y = "Temp",
                 color = "Year",
                 width = 800,
                 height = 400,
                 opacity = 0.5, 
                 facet_col = "Position Relative to Equator (0°N)")

# reduce whitespace
fig.update_layout(margin={"r":0,"t":50,"l":0,"b":0})
# show the plot
fig.show()
```
{% include bp1-equator-scatter.html %}

This visualization is quite useful as it depicts a number of things with respect to the temperature data. For one thing, as the year increases (from 1990 to 2020), we note that the average temperature per year also increases (which is expected given the current circumstances and global warming). Additionally, we are also clearly able to see the average temperature change over the year (Higher temperatures in January-December and lower temperatures in June-July). Interestingly, we note that the temperature does not fluctuate depending on the latitude - in this case, this is to be expected since Brazil is closer to the equator and hence in an equatorial climate zone. 

Another way of visualizing the temperature data in Brazil would be through a histogram, as shown below!

```python
fig = px.histogram(df2, 
                   x = "Temp", 
                   color = "Position Relative to Equator (0°N)",
                   opacity = 0.2, 
                   nbins = 35, 
                   barmode='stack',
                   width = 700,
                   height = 500)

# reduce whitespace
fig.update_layout(margin={"r":0,"t":0,"l":0,"b":0})
# show the plot
fig.show()
```
{% include bp1-equator-histogram.html %}

Interestingly, we note that the temperatures above the equator seem to be a little higher than the temperatures below the equator - an observation we were not able to derive from the previous visualization! We also note that temperatures closer to 26°C are far more common, which is to be expected since Brazil falls on the equator. 

We might also consider viewing the temperature data using a box plot, as shown below!


```python
fig = px.box(df2, 
             x = "Year", 
             y = "Temp",
             color = "Position Relative to Equator (0°N)",
             width = 1000,
             height = 400)

# reduce whitespace
fig.update_layout(margin={"r":0,"t":0,"l":0,"b":0})
# show the plot
fig.show()
```

{% include bp1-equator-boxplot.html %}

The above interactive visualization is extremely useful as we clearly see the upward incline in average temperatures - again, this is to be expected as average temperatures have increased on account of global warming. However, unlike the above histogram plot, we are not able to qualitatively determine that the temperatures at stations located above the equator might be slightly higher than the temperatures at stations located below the equator. 


{::options parse_block_html="true" /}
<div class="gave-help">
As far as this particular project was concerned, undoubtedly the most tedious part invovled data manipulation and querying the appropriate data. And though this part of the process was a tad bit challenging, there is not doubt that generating visualizations - even interactive ones at that - are far easier than if the were not manipulated and queried appropriately.

Additionally, I found querying the data a little bit challenging in the sense that it was important for me to plan out my visualizations before extracting the data. Often, I would have to re-query the appropriate data because I did not acquire all the data I needed to for the visualization. To be sure, a lesson learned is to plan out your visualizations in detail before attempting to query the data and construct it. 
</div>
{::options parse_block_html="false" /}
